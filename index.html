<!DOCTYPE html> 
<html> 
<!-- Define Head section, with links and scripts for use in Body -->
<head> 
<meta charset="utf-8" /> 
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

      
<!-- Get the leaflet CSS/JS sources -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

<!-- Get our internal CSS file -->
<link rel="stylesheet" href="style.css">

<!-- Get the AJAX source -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script src="leaflet.ajax.min.js" type="text/javascript" ></script>

<!-- Add jQuery -->
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>

</head> 

<body>

<!-- Specify the map and it's dimensions -->
<div id="map"></div> 

<!-- Load the precint/vote center GeoJSONs and enable JS code below  -->
<script type="text/javascript" src="cumbgeonoroads.geojson"></script>
<!-- <script type="text/javascript" src="vote_centers.geojson"></script> -->
<script type="text/javascript"> 

// Call the Leaflet JS functions
var map = L.map(
            "map",
            {
                center: [41.9666667, -71.4333333],
                // crs: L.CRS.EPSG32130,
                zoom: 13,
                zoomControl: false,
                preferCanvas: true,
            }
        );
L.control.scale().addTo(map);
L.control.zoom({position: 'topright'}).addTo(map);
var tile_layer = L.tileLayer(
            "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
            {"attribution": "Data by \u0026copy; \u003ca href=\"http://openstreetmap.org\"\u003eOpenStreetMap\u003c/a\u003e, under \u003ca href=\"http://www.openstreetmap.org/copyright\"\u003eODbL\u003c/a\u003e.", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 7, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
        ).addTo(map);


// Legend color pallette and function
function getColor(d) {
    return d > 100 ? '#800026' :
           d > 50  ? '#BD0026' :
           d > 20  ? '#E31A1C' :
           d > 10  ? '#FC4E2A' :
           d > 5   ? '#FD8D3C' :
           d > 2   ? '#FEB24C' :
           d > 1   ? '#FED976' :
                      '#FFEDA0';
}

function style(feature) {
    return {
        fillColor: getColor(feature.properties.ParcelArea),
        // fillColor: '#66000000',
        weight: 2,
        opacity: .5,
        color: '#4a4c4f',
        fillOpacity: 0.7
    };
}

function highlightFeature(e) {
    var layer = e.target;

    layer.setStyle({
			weight: 2.5,
			color: '#666',
            opacity: .75,
			dashArray: '',
			fillOpacity: 0.2
		});

    if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
        layer.bringToFront();
    }

    info.update(layer.feature.properties);
}

function resetHighlight(e) {
    polygons.resetStyle(e.target);
    info.update();
}

function zoomToFeature(e) {
    map.fitBounds(e.target.getBounds());
}

function onEachFeature(feature, layer) {
    layer.on({
        mouseover: highlightFeature,
        mouseout: resetHighlight,
        click: zoomToFeature
    });
}

// Create precint polygons
var polygons = L.geoJson(cumb, {
    style: style,
    onEachFeature: onEachFeature
}).addTo(map);

// Create custom VC layer control button
// var animatedToggle = L.easyButton({
//     id: 'animated-marker-toggle',
//     position: 'topright',
//     states: [{
//         stateName: 'add-markers',
//         icon: '<strong>Select Vote Center Layer</strong>',
//         onClick: function(control) {
//         map.addLayer(geojsonLayer);
//         map.addControl(vclegend);
//         control.state('remove-markers');
//         }
//     }, {
//         stateName: 'remove-markers',
//         icon: '<strong>Remove Vote Center Layer</strong>',
//         onClick: function(control) {
//         map.removeLayer(geojsonLayer);
//         map.removeControl(vclegend);
//         control.state('add-markers');
//         }
//     }]
// });
// animatedToggle.addTo(map);

// Geocoder: plugin from https://github.com/perliedman/leaflet-control-geocoder
// var geocoder = L.Control.geocoder({
//     id: 'geocode',
//     defaultMarkGeocode: false,
//     collapsed: false,
//     position: 'topright',
//     placeholder: 'Search for specific location...'
//     })
//     .on('markgeocode', function(e) {
//         var bbox = e.geocode.bbox;
//         var poly = L.polygon([
//             bbox.getSouthEast(),
//             bbox.getNorthEast(),
//             bbox.getNorthWest(),
//             bbox.getSouthWest()
//         ]);
//         map.fitBounds(poly.getBounds());
//     })
//     .addTo(map);

// Control that shows state info on hover
var info = L.control( {position: 'topleft'});

info.onAdd = function (map) {
    this._div = L.DomUtil.create('div', 'info');
    this.update();
    return this._div;
};

info.update = function (props) {
    this._div.innerHTML = 
        // '<h5>LA County Ballot Data</h5>' +
        // '<span class="alignleft";>Total Registered Voters:</span><span style="color:#800000" class="alignright";><b>'+la.features[la.features.length-1].properties["Number of Active Voters"]+'</span></b><br>'+
        // '<span class="alignleft";>Total Votes Cast:</span><span style="color:#800000" class="alignright";><b>'+la.features[la.features.length-1].properties["Total Votes"]+'</span></b><br>'+
        // '<span class="alignleft";>Percent of Registered Voters Casting Ballots: </span><span style="color:#800000" class="alignright";><b>'+la.features[la.features.length-1].properties["Percent Votes Cast"]+'</span></b><br>'+
        // '<span class="alignleft";>Percent of All Ballots Cast by Mail: </span><span style="color:#800000" class="alignright";><b>'+la.features[la.features.length-1].properties["Percent Mail"]+'</span></b><br>'+
        // '<span class="alignleft";>Percent of All Ballots Cast by Drop Box: &nbsp;</span><span style="color:#800000" class="alignright";><b>'+la.features[la.features.length-1].properties["Percent Drop Box"]+'</span></b><br>'+
        // '<span class="alignleft";>Percent of All Ballots Cast In-Person: </span><span style="color:#800000" class="alignright";><b>'+la.features[la.features.length-1].properties["Percent Poll"]+'</span></b><br>'+
        // '<span class="alignleft";>Percent of All Ballots Dropped Off at Vote Centers:&nbsp;</span><span style="color:#800000" class="alignright";><b>'+la.features[la.features.length-1].properties["Percent Vote Center Drop Off"]+'</span></b><br>'+
        // '<span class="alignleft";>Conditional Voter Registration:</span><span style="color:#800000" class="alignright";><b>'+la.features[la.features.length-1].properties["Conditional Voter Registration"]+'</span></b><br>'+
        // '<br><hr>'+
        '<h4>Cumberland Parcel Data</h4>' + 
      (
        props ?
        '<span class="alignleft";>Parcel ID: </span><span style="color:#004080" class="alignright";><b>'+props.ParcelID+'</b></span>'+ 
        '<br><span class="alignleft";>Lot: </span><span style="color:#004080" class="alignright";><b>'+props.Lot+'</span></b>'+
        '<br><span class="alignleft";>Parcel Area: </span><span style="color:#004080" class="alignright";><b>'+props.ParcelArea+'</span></b>'+
        // '<br><span class="alignleft";>Percent of Registered Voters Casting Ballots: </span><span style="color:#004080" class="alignright";><b>'+props['Percent Votes Cast']+'</span></b>'+
        // '<br><span class="alignleft";>Percent of All Ballots Cast by Mail: </span><span style="color:#004080" class="alignright";><b>'+props["Percent Mail"]+'</span></b>'+
        // '<br><span class="alignleft";>Percent of All Ballots Cast by Drop Box: </span><span style="color:#004080" class="alignright";><b>'+props["Percent Drop Box"]+'</span></b>'+
        // '<br><span class="alignleft";>Percent of All Ballots Cast In-Person: </span><span style="color:#004080" class="alignright";><b>'+props["Percent Poll"]+'</span></b>' +
        // '<br><span class="alignleft";>Percent of all Ballots Dropped Off at Vote Centers: </span><span style="color:#004080" class="alignright";><b>'+props["Percent Vote Center Drop Off"]+'</span></b>'+
        '<br><span class="alignleft";>Date of Construction: </span><span style="color:#004080" class="alignright";><b>'+props.Lot+'</span></b>'
        : 'Hover over a parcel to view data'
        );
};

info.addTo(map);

var legend = L.control({position: 'bottomright'});

legend.onAdd = function (map) {

    var div = L.DomUtil.create('div', 'info legend'),
        grades = [0, 1, 2, 5, 10, 20, 50, 100],
        labels = [];

    // loop through our density intervals and generate a label with a colored square for each interval
    for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
            '<i style="background:' + getColor(grades[i] + 1) + '"></i> ' +
            grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
    }

    return div;
};

legend.addTo(map);

</script>
</body> 
</html> 